{% extends 'portfolio/base.html' %}
{% load static %}

{% block title %}Personal Information - Step 1{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/portfolio_standardized.css' %}">
{% endblock %}

{% block content %}
<div class="portfolio-container" data-current-step="personal_info1">
    <div style="width: 100%; max-width: 900px; margin: 0 auto;">
        <!-- Wizard Progress Component -->
        {% include "portfolio/wizard_progress.html" %}
        <div class="portfolio-form-container portfolio-fade-in">
            <div class="portfolio-text-center">
                <h1 class="portfolio-title">Step 1: Personal Information</h1>
                <p class="portfolio-subtitle">Let's start with your basic information</p>
                <div class="portfolio-alert portfolio-alert-info"
                    style="margin: 20px 0; background: linear-gradient(135deg, #dbeafe, #bfdbfe); border: 1px solid #3b82f6; color: #1e40af; padding: 15px; border-radius: 12px; text-align: left;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-info-circle" style="font-size: 18px;"></i>
                        <div>
                            <strong>Required First Step:</strong> Complete this personal information section before
                            proceeding to other portfolio sections. This information is essential for your portfolio.
                        </div>
                    </div>
                </div>
            </div>

            <form method="post" enctype="multipart/form-data" autocomplete="off" class="portfolio-w-full">
                {% csrf_token %}
                <div class="portfolio-form-content">
                    <div class="portfolio-form-row">
                        <!-- First Name -->
                        <div class="portfolio-form-group">
                            <label for="{{ form.first_name.id_for_label }}" class="portfolio-label">
                                {{ form.first_name.label }}
                                {% if form.first_name.field.required %}<span class="portfolio-error">*</span>{% endif %}
                            </label>
                            {{ form.first_name }}
                            {% if form.first_name.help_text %}
                            <small class="portfolio-help-text">{{ form.first_name.help_text }}</small>
                            {% endif %}
                            {% for error in form.first_name.errors %}
                            <div class="portfolio-error">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <!-- Last Name -->
                        <div class="portfolio-form-group">
                            <label for="{{ form.last_name.id_for_label }}" class="portfolio-label">
                                {{ form.last_name.label }}
                                {% if form.last_name.field.required %}<span class="portfolio-error">*</span>{% endif %}
                            </label>
                            {{ form.last_name }}
                            {% if form.last_name.help_text %}
                            <small class="portfolio-help-text">{{ form.last_name.help_text }}</small>
                            {% endif %}
                            {% for error in form.last_name.errors %}
                            <div class="portfolio-error">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <!-- Email -->
                        <div class="portfolio-form-group">
                            <label for="{{ form.email.id_for_label }}" class="portfolio-label">
                                {{ form.email.label }}
                                {% if form.email.field.required %}<span class="portfolio-error">*</span>{% endif %}
                            </label>
                            {{ form.email }}
                            {% if form.email.help_text %}
                            <small class="portfolio-help-text">{{ form.email.help_text }}</small>
                            {% endif %}
                            {% for error in form.email.errors %}
                            <div class="portfolio-error">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <!-- Contact -->
                        <div class="portfolio-form-group">
                            <label for="{{ form.contact.id_for_label }}" class="portfolio-label">
                                {{ form.contact.label }}
                                {% if form.contact.field.required %}<span class="portfolio-error">*</span>{% endif %}
                            </label>
                            <div class="portfolio-flex portfolio-items-center portfolio-spacing-sm">
                                <span
                                    class="portfolio-bg-gray-100 portfolio-border portfolio-border-gray-300 portfolio-text-gray-700"
                                    style="border-radius: 8px; padding: 0.375rem 0.5rem;">+91</span>
                                <input type="tel" name="contact" id="{{ form.contact.id_for_label }}"
                                    class="portfolio-input portfolio-rounded-r-lg"
                                    placeholder="Enter 10-digit mobile number" maxlength="10"
                                    value="{% if form.data.contact %}{{ form.data.contact|cut:'+91' }}{% else %}{{ form.contact.value|cut:'+91' }}{% endif %}"
                                    pattern="[0-9]{10}" required />
                            </div>
                            {% if form.contact.help_text %}
                            <small class="portfolio-help-text">{{ form.contact.help_text }}</small>
                            {% endif %}
                            {% for error in form.contact.errors %}
                            <div class="portfolio-error">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <!-- Address -->
                        <div class="portfolio-form-group">
                            <label for="{{ form.address.id_for_label }}" class="portfolio-label">
                                {{ form.address.label }}
                                {% if form.address.field.required %}<span class="portfolio-error">*</span>{% endif %}
                            </label>
                            {{ form.address }}
                            {% if form.address.help_text %}
                            <small class="portfolio-help-text">{{ form.address.help_text }}</small>
                            {% endif %}
                            {% for error in form.address.errors %}
                            <div class="portfolio-error">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <!-- Pin Code -->
                        <div class="portfolio-form-group">
                            <label for="{{ form.pin_code.id_for_label }}" class="portfolio-label">
                                {{ form.pin_code.label }}
                                {% if form.pin_code.field.required %}<span class="portfolio-error">*</span>{% endif %}
                            </label>
                            {{ form.pin_code }}
                            {% if form.pin_code.help_text %}
                            <small class="portfolio-help-text">{{ form.pin_code.help_text }}</small>
                            {% endif %}
                            {% for error in form.pin_code.errors %}
                            <div class="portfolio-error">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <!-- Profile Photo -->
                        <div class="portfolio-form-group">
                            <label for="{{ form.profile_photo.id_for_label }}" class="portfolio-label">
                                {{ form.profile_photo.label }}
                                {% if form.profile_photo.field.required %}
                                <span class="portfolio-error">*</span>
                                {% endif %}
                            </label>

                            <!-- Profile Photo Row - Current Photo and File Upload Side by Side -->
                            <div class="portfolio-profile-photo-row">
                                <!-- Current Photo Display -->
                                <div class="portfolio-current-photo">
                                    {% if portfolio.user_profile.profile_photo %}
                                    <img src="{{ portfolio.user_profile.profile_photo.url }}"
                                        alt="Current Profile Photo" class="portfolio-profile-img">
                                    <small class="portfolio-photo-label">Current photo</small>
                                    {% else %}
                                    <div class="portfolio-profile-placeholder">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <small class="portfolio-photo-label">No photo</small>
                                    {% endif %}
                                </div>

                                <!-- File Input Section -->
                                <div class="portfolio-file-upload">
                                    <input type="file" name="profile_photo" accept="image/*"
                                        class="portfolio-file-input" onchange="previewProfilePhoto(this)">
                                    <small class="portfolio-help-text">Recommended: Square image, 200x200 pixels or
                                        larger</small>
                                </div>
                            </div>

                            <!-- Photo Preview Area -->
                            <div id="photoPreview" class="portfolio-preview-area hidden">
                                <img id="previewImg" src="" alt="Photo Preview" class="portfolio-profile-img">
                                <small class="portfolio-photo-label">Preview</small>
                            </div>

                            {% if form.profile_photo.help_text %}
                            <small class="portfolio-help-text">{{ form.profile_photo.help_text }}</small>
                            {% endif %}
                            {% for error in form.profile_photo.errors %}
                            <div class="portfolio-error">{{ error }}</div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="portfolio-btn-group">
                    <button type="submit" class="portfolio-btn portfolio-btn-primary">
                        <i class="fas fa-arrow-right"></i> Next Step
                    </button>
                </div>
            </form>
        </div>
    </div>
    {% endblock %}

    {% block extra_js %}
    <script src="{% static 'js/forms.js' %}"></script>
    <script src="{% static 'js/personal_info.js' %}"></script>
    <script src="{% static 'js/personal_info_modern.js' %}"></script>
    <script>
        // Profile photo preview function
        function previewProfilePhoto(input) {
            const previewDiv = document.getElementById('photoPreview');
            const previewImg = document.getElementById('previewImg');

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImg.src = e.target.result;
                    previewDiv.classList.remove('hidden');
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                previewDiv.classList.add('hidden');
            }
        }

        // Auto-expanding textarea function
        function autoResizeTextarea(textarea) {
            // Reset height to auto to get the correct scrollHeight
            textarea.style.height = 'auto';
            // Set the height to match the content
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // Initialize auto-expanding textareas when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            // Find the address textarea
            const addressTextarea = document.querySelector('textarea[name="address"]');

            if (addressTextarea) {
                // Set initial height
                autoResizeTextarea(addressTextarea);

                // Add event listeners for auto-resizing
                addressTextarea.addEventListener('input', function () {
                    autoResizeTextarea(this);
                });

                addressTextarea.addEventListener('focus', function () {
                    autoResizeTextarea(this);
                });
            }
        });
    </script>
    {% endblock %}