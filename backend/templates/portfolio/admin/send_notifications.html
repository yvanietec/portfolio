{% extends 'portfolio/admin/admin_base.html' %}

{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_forms.css' %}">
{% endblock %}

{% block content %}
<div class="admin-form-container">
    <!-- Notification Header -->
    <div class="admin-form-header" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">
        <h1 class="admin-form-title">
            <i class="fas fa-bullhorn"></i>
            Send Notification
        </h1>
        <p class="admin-form-subtitle">Broadcast messages to users across the platform</p>
    </div>

    <!-- Messages Display -->
    {% if messages %}
    <div class="notification-messages">
        {% for message in messages %}
        <div class="notification-message notification-message-success">
            <div class="notification-message-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="notification-message-content">
                {{ message }}
            </div>
            <button class="notification-message-close" onclick="this.parentElement.remove()">&times;</button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Notification Form Card -->
    <div class="admin-form-card">
        <!-- Notification Type Selector -->
        <div class="notification-type-selector">
            <h3 class="notification-section-title">
                <i class="fas fa-cog"></i>
                Notification Settings
            </h3>
            <div class="notification-type-grid">
                <div class="notification-type-option">
                    <input type="radio" id="typeAll" name="notification_type" value="all" checked>
                    <label for="typeAll" class="notification-type-label">
                        <div class="notification-type-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="notification-type-content">
                            <h4>All Users</h4>
                            <p>Send to every registered user</p>
                        </div>
                    </label>
                </div>
                <div class="notification-type-option">
                    <input type="radio" id="typeStudents" name="notification_type" value="students">
                    <label for="typeStudents" class="notification-type-label">
                        <div class="notification-type-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="notification-type-content">
                            <h4>Students Only</h4>
                            <p>Send to student accounts</p>
                        </div>
                    </label>
                </div>
                <div class="notification-type-option">
                    <input type="radio" id="typeAgents" name="notification_type" value="agents">
                    <label for="typeAgents" class="notification-type-label">
                        <div class="notification-type-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="notification-type-content">
                            <h4>Agents Only</h4>
                            <p>Send to agent accounts</p>
                        </div>
                    </label>
                </div>
                <div class="notification-type-option">
                    <input type="radio" id="typeCustom" name="notification_type" value="custom">
                    <label for="typeCustom" class="notification-type-label">
                        <div class="notification-type-icon">
                            <i class="fas fa-filter"></i>
                        </div>
                        <div class="notification-type-content">
                            <h4>Custom Filter</h4>
                            <p>Select specific users</p>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- Notification Form -->
        <form method="POST" id="notificationForm">
            {% csrf_token %}

            <div class="notification-form-section">
                <h3 class="notification-section-title">
                    <i class="fas fa-edit"></i>
                    Message Content
                </h3>

                <div class="admin-form-grid">
                    <!-- Title Field -->
                    <div class="admin-form-group admin-form-grid-full">
                        <label for="title" class="admin-form-label required">
                            <i class="fas fa-heading"></i>
                            Notification Title
                        </label>
                        <div class="admin-form-input-group">
                            <input type="text" name="title" id="title" class="admin-form-control"
                                placeholder="Enter a compelling title for your notification" required maxlength="100">
                        </div>
                        <div class="notification-char-count">
                            <span id="titleCount">0</span>/100 characters
                        </div>
                    </div>

                    <!-- Message Field -->
                    <div class="admin-form-group admin-form-grid-full">
                        <label for="message" class="admin-form-label required">
                            <i class="fas fa-comment"></i>
                            Message Content
                        </label>
                        <div class="admin-form-input-group">
                            <textarea name="message" id="message"
                                class="admin-form-control textarea notification-message-input" rows="6"
                                placeholder="Write your notification message here. You can include important updates, announcements, or any information you want to share with users."
                                required maxlength="500"></textarea>
                        </div>
                        <div class="notification-char-count">
                            <span id="messageCount">0</span>/500 characters
                        </div>
                    </div>

                    <!-- Priority Level -->
                    <div class="admin-form-group">
                        <label for="priority" class="admin-form-label">
                            <i class="fas fa-exclamation-triangle"></i>
                            Priority Level
                        </label>
                        <div class="admin-form-input-group">
                            <select name="priority" id="priority" class="admin-form-control">
                                <option value="low">Low Priority</option>
                                <option value="normal" selected>Normal Priority</option>
                                <option value="high">High Priority</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>

                    <!-- Send Method -->
                    <div class="admin-form-group">
                        <label for="send_method" class="admin-form-label">
                            <i class="fas fa-paper-plane"></i>
                            Send Method
                        </label>
                        <div class="admin-form-input-group">
                            <select name="send_method" id="send_method" class="admin-form-control">
                                <option value="immediate">Send Immediately</option>
                                <option value="scheduled">Schedule for Later</option>
                            </select>
                        </div>
                    </div>

                    <!-- Schedule Time (Hidden by default) -->
                    <div class="admin-form-group admin-form-grid-full" id="scheduleSection" style="display: none;">
                        <label for="schedule_time" class="admin-form-label">
                            <i class="fas fa-clock"></i>
                            Schedule Time
                        </label>
                        <div class="admin-form-input-group">
                            <input type="datetime-local" name="schedule_time" id="schedule_time"
                                class="admin-form-control">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="notification-preview-section">
                <h3 class="notification-section-title">
                    <i class="fas fa-eye"></i>
                    Preview
                </h3>
                <div class="notification-preview">
                    <div class="notification-preview-header">
                        <div class="notification-preview-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="notification-preview-title" id="previewTitle">
                            Your notification title will appear here
                        </div>
                        <div class="notification-preview-priority" id="previewPriority">
                            Normal
                        </div>
                    </div>
                    <div class="notification-preview-message" id="previewMessage">
                        Your notification message will appear here as you type...
                    </div>
                    <div class="notification-preview-meta">
                        <span class="notification-preview-time">Just now</span>
                        <span class="notification-preview-audience" id="previewAudience">All Users</span>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="admin-form-actions">
                <button type="submit" class="admin-form-btn admin-form-btn-primary">
                    <i class="fas fa-paper-plane"></i>
                    Send Notification
                </button>
                <button type="button" class="admin-form-btn admin-form-btn-secondary" onclick="resetForm()">
                    <i class="fas fa-undo"></i>
                    Reset Form
                </button>
                <button type="button" class="admin-form-btn admin-form-btn-info" onclick="saveDraft()">
                    <i class="fas fa-save"></i>
                    Save as Draft
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/admin_notifications.js' %}"></script>
{% endblock %}